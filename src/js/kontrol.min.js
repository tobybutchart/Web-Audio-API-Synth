/*!jQuery Kontrol*/
(function(d){var b={},a=Math.max,c=Math.min;b.c={};b.c.d=d(document);b.c.t=function(f){return f.originalEvent.touches.length-1};b.o=function(){var e=this;this.o=null;this.$=null;this.i=null;this.g=null;this.v=null;this.cv=null;this.x=0;this.y=0;this.mx=0;this.my=0;this.$c=null;this.c=null;this.t=0;this.isInit=false;this.fgColor=null;this.pColor=null;this.sH=null;this.dH=null;this.cH=null;this.eH=null;this.rH=null;this.run=function(){var f=function(i,h){var g;for(g in h){e.o[g]=h[g]}e.init();e._configure()._draw()};if(this.$.data("kontroled")){return}this.$.data("kontroled",true);this.extend();this.o=d.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:true,readOnly:this.$.data("readonly"),noScroll:this.$.data("noScroll"),cursor:(this.$.data("cursor")===true&&30)||this.$.data("cursor")||0,thickness:this.$.data("thickness")||0.35,width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inline:false,start:null,draw:null,change:null,cancel:null,release:null},this.o);if(this.$.is("fieldset")){this.v={};this.i=this.$.find("input");this.i.each(function(g){var h=d(this);e.i[g]=h;e.v[g]=h.val();h.bind("change",function(){var i={};i[g]=h.val();e.val(i)})});this.$.find("legend").remove()}else{this.i=this.$;this.v=this.$.val();(this.v=="")&&(this.v=this.o.min);this.$.bind("change",function(){e.val(e.$.val())})}(!this.o.displayInput)&&this.$.hide();this.$c=d('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"></canvas>');this.c=this.$c[0].getContext("2d");this.$.wrap(d('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c);if(this.v instanceof Object){this.cv={};this.copy(this.v,this.cv)}else{this.cv=this.v}this.$.bind("configure",f).parent().bind("configure",f);this._listen()._configure()._xy().init();this.isInit=true;this._draw();return this};this._draw=function(){var f=true,g=document.createElement("canvas");g.width=e.o.width;g.height=e.o.height;e.g=g.getContext("2d");e.clear();e.dH&&(f=e.dH());(f!==false)&&e.draw();e.c.drawImage(g,0,0);g=null};this._touch=function(f){var g=function(i){var h=e.xy2val(i.originalEvent.touches[e.t].pageX,i.originalEvent.touches[e.t].pageY,"touch");if(h==e.cv){return}if(e.cH&&(e.cH(h)===false)){return}e.change(h);e._draw()};this.t=b.c.t(f);if(this.sH&&(this.sH()===false)){return}g(f);b.c.d.bind("touchmove.k",g).bind("touchend.k",function(){b.c.d.unbind("touchmove.k touchend.k");if(e.rH&&(e.rH(e.cv)===false)){return}e.val(e.cv)});return this};this._mouse=function(g){var f=function(i){var h=e.xy2val(i.pageX,i.pageY,"mouse");if(h==e.cv){return}if(e.cH&&(e.cH(h)===false)){return}e.change(h);e._draw()};if(this.sH&&(this.sH()===false)){return}e.mx=g.pageX;e.my=g.pageY;f(g);b.c.d.bind("mousemove.k",f).bind("keyup.k",function(h){if(h.keyCode===27){b.c.d.unbind("mouseup.k mousemove.k keyup.k");if(e.eH&&(e.eH()===false)){return}e.cancel()}}).bind("mouseup.k",function(h){b.c.d.unbind("mousemove.k mouseup.k keyup.k");if(e.rH&&(e.rH(e.cv)===false)){return}e.val(e.cv)});return this};this._xy=function(){var f=this.$c.offset();this.x=f.left;this.y=f.top;return this};this._listen=function(){if(!this.o.readOnly){this.$c.bind("mousedown",function(f){f.preventDefault();e._xy()._mouse(f)}).bind("touchstart",function(f){f.preventDefault();e._xy()._touch(f)});this.listen()}else{this.$.attr("readonly","readonly")}return this};this._configure=function(){if(this.o.start){this.sH=this.o.start}if(this.o.draw){this.dH=this.o.draw}if(this.o.change){this.cH=this.o.change}if(this.o.cancel){this.eH=this.o.cancel}if(this.o.release){this.rH=this.o.release}if(this.o.displayPrevious){this.pColor=this.h2rgba(this.o.fgColor,"0.4");this.fgColor=this.h2rgba(this.o.fgColor,"0.6")}else{this.fgColor=this.o.fgColor}return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(f){};this.val=function(f){};this.xy2val=function(f,h,g){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(i,f){var g;i=i.substring(1,7);g=[parseInt(i.substring(0,2),16),parseInt(i.substring(2,4),16),parseInt(i.substring(4,6),16)];return"rgba("+g[0]+","+g[1]+","+g[2]+","+f+")"};this.copy=function(j,h){for(var g in j){h[g]=j[g]}}};b.Dial=function(){b.o.call(this);this.startAngle=null;this.xy=null;this.radius=null;this.lineWidth=null;this.cursorExt=null;this.w2=null;this.PI2=2*Math.PI;this.extend=function(){this.o=d.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,flatMouse:this.$.data("flatMouse"),inline:true},this.o)};this.val=function(e){if(null!=e){this.cv=this.o.stopper?a(c(e,this.o.max),this.o.min):e;this.v=this.cv;this.$.val(this.v);this._draw()}else{return this.v}};this.xy2val=function(f,i,e){var g,h;if((e==="mouse")&&(this.o.flatMouse)){g=((this.my-i)+(f-this.mx))/(this.o.height);h=~~(g*(this.o.max-this.o.min)+parseFloat(this.v));h=a(c(h,this.o.max),this.o.min)}else{g=Math.atan2(f-(this.x+this.w2),-(i-this.y-this.w2))-this.angleOffset;if(this.angleArc!=this.PI2&&(g<0)&&(g>-0.5)){g=0}else{if(g<0){g+=this.PI2}}h=~~(0.5+(g*(this.o.max-this.o.min)/this.angleArc))+this.o.min}this.o.stopper&&(h=a(c(h,this.o.max),this.o.min));return h};this.listen=function(){var f=this,j=function(o){if(f.o.noScroll){return}o.preventDefault();var n=o.originalEvent,l=n.detail||n.wheelDeltaX,k=n.detail||n.wheelDeltaY,m=parseInt(f.$.val())+(l>0||k>0?1:l<0||k<0?-1:0);if(f.cH&&(f.cH(m)===false)){return}f.val(m)},h,i,e=1,g={37:-1,38:1,39:1,40:-1};this.$.bind("keydown",function(m){var l=m.keyCode;if(l>=96&&l<=105){l=m.keyCode=l-48}h=parseInt(String.fromCharCode(l));if(isNaN(h)){(l!==13)&&(l!==8)&&(l!==9)&&(l!==189)&&m.preventDefault();if(d.inArray(l,[37,38,39,40])>-1){m.preventDefault();var k=parseInt(f.$.val())+g[l]*e;f.o.stopper&&(k=a(c(k,f.o.max),f.o.min));f.change(k);f._draw();i=window.setTimeout(function(){e*=2},30)}}}).bind("keyup",function(k){if(isNaN(h)){if(i){window.clearTimeout(i);i=null;e=1;f.val(f.$.val())}}else{(f.$.val()>f.o.max&&f.$.val(f.o.max))||(f.$.val()<f.o.min&&f.$.val(f.o.min))}});this.$c.bind("mousewheel DOMMouseScroll",j);this.$.bind("mousewheel DOMMouseScroll",j)};this.init=function(){if(this.v<this.o.min||this.v>this.o.max){this.v=this.o.min}this.$.val(this.v);this.w2=this.o.width/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2;this.lineWidth=this.xy*this.o.thickness;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=a(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:((this.o.width/2+4)>>0)+"px",height:((this.o.width/3)>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":((this.o.width/3)>>0)+"px","margin-left":"-"+((this.o.width*3/4+2)>>0)+"px",border:0,background:"none",font:"bold "+((this.o.width/e)>>0)+"px Arial","text-align":"center",color:this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(e){this.cv=e;this.$.val(e)};this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.draw=function(){var k=this.g,f=this.angle(this.cv),g=this.startAngle,h=g+f,e,i,j=1;k.lineWidth=this.lineWidth;this.o.cursor&&(g=h-this.cursorExt)&&(h=h+this.cursorExt);k.beginPath();k.strokeStyle=this.o.bgColor;k.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,true);k.stroke();if(this.o.displayPrevious){i=this.startAngle+this.angle(this.v);e=this.startAngle;this.o.cursor&&(e=i-this.cursorExt)&&(i=i+this.cursorExt);k.beginPath();k.strokeStyle=this.pColor;k.arc(this.xy,this.xy,this.radius,e,i,false);k.stroke();j=(this.cv==this.v)}k.beginPath();k.strokeStyle=j?this.o.fgColor:this.fgColor;k.arc(this.xy,this.xy,this.radius,g,h,false);k.stroke()};this.cancel=function(){this.val(this.v)}};d.fn.dial=d.fn.knob=function(e){return this.each(function(){var f=new b.Dial();f.o=e;f.$=d(this);f.run()}).parent()};b.XY=function(){b.o.call(this);this.m=[];this.p=[];this.f=[];this.s={0:1,1:-1};this.cur2=0;this.cursor=0;this.v={};this.div=null;this.extend=function(){this.o=d.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,width:this.$.data("width")||200,height:this.$.data("height")||200},this.o)};this._coord=function(){for(var e in this.v){this.m[e]=~~(0.5+((this.s[e]*this.v[e]-this.o.min)/this.f[e])+this.cur2);this.p[e]=this.m[e]}};this.init=function(){this.cursor=this.o.cursor||30;this.cur2=this.cursor/2;this.f[0]=(this.o.max-this.o.min)/(this.o.width-this.cursor);this.f[1]=(this.o.max-this.o.min)/(this.o.height-this.cursor);if(!this.isInit){this._coord()}if(this.o.displayInput){var e=this;this.$.css({"margin-top":"-30px",border:0,font:"11px Arial"});this.i.each(function(){d(this).css({width:(e.o.width/4)+"px",border:0,background:"none",color:e.o.fgColor,padding:"0px","-webkit-appearance":"none"})})}else{this.$.css({width:"0px",visibility:"hidden"})}};this.xy2val=function(e,f){this.m[0]=a(this.cur2,c(e-this.x,this.o.width-this.cur2));this.m[1]=a(this.cur2,c(f-this.y,this.o.height-this.cur2));return{0:~~(this.o.min+(this.m[0]-this.cur2)*this.f[0]),1:~~(this.o.min+(this.o.height-this.m[1]-this.cur2)*this.f[1])}};this.change=function(e){this.cv=e;this.i[0].val(this.cv[0]);this.i[1].val(this.cv[1])};this.val=function(e){if(null!==e){this.cv=e;this.copy(this.cv,this.v);this._coord();this._draw()}else{return this.v}};this.cancel=function(){this.copy(this.v,this.cv);this.i[0].val(this.cv[0]);this.i[1].val(this.cv[1]);this.m[0]=this.p[0];this.m[1]=this.p[1];this._draw()};this.draw=function(){var f=this.g,e=1;if(this.o.displayPrevious){f.beginPath();f.lineWidth=this.cursor;f.strokeStyle=this.pColor;f.moveTo(this.p[0],this.p[1]+this.cur2);f.lineTo(this.p[0],this.p[1]-this.cur2);f.stroke();e=(this.cv[0]==this.v[0]&&this.cv[1]==this.v[1])}f.beginPath();f.lineWidth=this.cursor;f.strokeStyle=e?this.o.fgColor:this.fgColor;f.moveTo(this.m[0],this.m[1]+this.cur2);f.lineTo(this.m[0],this.m[1]-this.cur2);f.stroke()}};d.fn.xy=function(e){return this.each(function(){var f=new b.XY();f.$=d(this);f.o=e;f.run()}).parent()};b.Bars=function(){b.o.call(this);this.bar=null;this.mid=null;this.col=null;this.colWidth=null;this.fontSize=null;this.displayMidLine=false;this.extend=function(){this.o=d.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,width:this.$.data("width")||600,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),height:(this.$.data("height")||200),fgColor:this.$.data("fgcolor")||"#87CEEB",bgColor:this.$.data("bgcolor")||"#CCCCCC",cols:this.$.data("cols")||8,spacing:this.$.data("spacing")||1},this.o);(this.o.cols==1)&&(this.o.spacing=0);this.colWidth=(((this.o.width-this.o.spacing*this.o.cols)/this.o.cols)>>0);if(this.o.displayInput){this.fontSize=a(~~(this.colWidth/3),10);this.o.height-=this.fontSize}};this.xy2val=function(e,i){var f=this.colWidth+this.o.spacing,h=(a(this.o.min,c(this.o.max,-(-this.mid+(i-this.y))/this.bar)))>>0,g={};this.col=a(0,c(this.o.cols-1,((e-this.x)/f)>>0));g[this.col]=h;return g};this.init=function(){this.bar=this.o.height/(this.o.max-this.o.min);this.mid=(this.o.max*this.bar)>>0;this.displayMidLine=this.o.cursor&&this.o.min<0;if(this.o.displayInput){var e=this;this.$.css({margin:"0px",border:0,padding:"0px"});this.i.each(function(){d(this).css({width:(e.colWidth-4+e.o.spacing)+"px",border:0,background:"none",font:e.fontSize+"px Arial",color:e.o.fgColor,margin:"0px",padding:"0px","-webkit-appearance":"none","text-align":"center"})})}else{this.$.css({width:"0px",visibility:"hidden"})}};this.change=function(e){for(var f in e){this.cv[f]=e[f];this.i[f].val(this.cv[f])}};this.val=function(e){if(null!==e){this.copy(e,this.cv);this.copy(this.cv,this.v);this.col=null;this._draw()}else{return this.v}};this.cancel=function(){this.copy(this.v,this.cv);this.col=null;this._draw()};this._bar=function(f){var e=(f*(this.colWidth+this.o.spacing)+this.colWidth/2);if(this.displayMidLine){this.g.beginPath();this.g.lineWidth=this.colWidth;this.g.strokeStyle=this.o.fgColor;this.g.moveTo(e,this.mid);this.g.lineTo(e,this.mid+1);this.g.stroke()}if(this.o.displayPrevious){this.g.beginPath();this.g.lineWidth=this.colWidth;this.g.strokeStyle=(this.cv[f]==this.v[f])?this.o.fgColor:this.pColor;if(this.o.cursor){this.g.lineTo(e,this.mid-((this.v[f]*this.bar)>>0)+this.o.cursor/2)}else{this.g.moveTo(e,this.mid)}this.g.lineTo(e,this.mid-((this.v[f]*this.bar)>>0)-this.o.cursor/2);this.g.stroke()}this.g.beginPath();this.g.lineWidth=this.colWidth;this.g.strokeStyle=this.fgColor;if(this.o.cursor){this.g.lineTo(e,this.mid-((this.cv[f]*this.bar)>>0)+this.o.cursor/2)}else{this.g.moveTo(e,this.mid)}this.g.lineTo(e,this.mid-((this.cv[f]*this.bar)>>0)-this.o.cursor/2);this.g.stroke()};this.clear=function(){if(this.col){this.c.clearRect(this.col*(this.colWidth+this.o.spacing),0,this.colWidth+this.o.spacing,this.o.height)}else{this._clear()}};this.draw=function(){if(this.col){this._bar(this.col)}else{for(var e=0;e<this.o.cols;e++){this._bar(e)}}}};d.fn.bars=function(e){return this.each(function(){var f=new b.Bars();f.$=d(this);f.o=e;f.run()}).parent()}})(jQuery);