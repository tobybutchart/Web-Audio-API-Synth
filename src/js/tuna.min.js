(function(){var k,n,g=function(r,q){r.value=q},j=Object.create(null,{activate:{writable:true,value:function(q){if(q){this.input.disconnect();this.input.connect(this.activateNode);if(this.activateCallback){this.activateCallback(q)}}else{this.input.disconnect();this.input.connect(this.output)}}},bypass:{get:function(){return this._bypass},set:function(q){if(this._lastBypassValue===q){return}this._bypass=q;this.activate(!q);this._lastBypassValue=q}},connect:{value:function(q){this.output.connect(q)}},disconnect:{value:function(q){this.output.disconnect(q)}},connectInOrder:{value:function(r){var q=r.length-1;while(q--){if(!r[q].connect){return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",r[q])}if(r[q+1].input){r[q].connect(r[q+1].input)}else{r[q].connect(r[q+1])}}}},getDefaults:{value:function(){var q={};for(var r in this.defaults){q[r]=this.defaults[r].value}return q}},automate:{value:function(y,x,w,u){var s=u?~~(u/1000):k.currentTime,r=w?~~(w/1000):0,t=this.defaults[y],v=this[y],q;if(v){if(t.automatable){if(!w){q="setValueAtTime"}else{q="linearRampToValueAtTime";v.cancelScheduledValues(s);v.setValueAtTime(v.value,s)}v[q](x,r+s)}else{v=x}}else{console.error("Invalid Property for "+this.name)}}}}),p="float",h="boolean",i="string",c="int";if(typeof module!=="undefined"&&module.exports){module.exports=b}else{if(typeof define==="function"){window.define("Tuna",f)}else{window.Tuna=b}}function f(){return b}function b(q){if(!(this instanceof b)){return new b(q)}var r=typeof window==="undefined"?{}:window;if(!r.AudioContext){r.AudioContext=r.webkitAudioContext}if(!q){console.log("tuna.js: Missing audio context! Creating a new context for you.");q=r.AudioContext&&(new r.AudioContext())}if(!q){throw new Error("Tuna cannot initialize because this environment does not support web audio.")}o(q);k=q;n=this}function o(s){if(s.__connectified__===true){return}var u=s.createGain(),t=Object.getPrototypeOf(Object.getPrototypeOf(u)),r=t.connect;t.connect=q;s.__connectified__=true;function q(){var v=arguments[0];arguments[0]=j.isPrototypeOf?(j.isPrototypeOf(v)?v.input:v):(v.input||v);r.apply(this,arguments);return v}}function l(q){return Math.max(0,Math.round(100*Math.pow(2,q/6))/100)}function d(r,z){var u,v,w=0,t=0,s=0,q=0;u=r.toExponential().match(/^.\.?(.*)e(.+)$/);w=parseInt(u[2],10)-(u[1]+"").length;u=z.toExponential().match(/^.\.?(.*)e(.+)$/);t=parseInt(u[2],10)-(u[1]+"").length;if(t>w){w=t}v=(r%z);if(w<-100||w>20){s=Math.round(Math.log(v)/Math.log(10));q=Math.pow(10,s);return(v/q).toFixed(s-w)*q}else{return parseFloat(v.toFixed(-w))}}function e(q){if(q===0){return 1}else{return Math.abs(q)/q}}function a(q){return(Math.exp(q)-Math.exp(-q))/(Math.exp(q)+Math.exp(-q))}function m(q,r){return q===undefined?r:q}b.prototype.Bitcrusher=function(u){if(!u){u=this.getDefaults()}this.bufferSize=u.bufferSize||this.defaults.bufferSize.value;this.input=k.createGain();this.activateNode=k.createGain();this.processor=k.createScriptProcessor(this.bufferSize,1,1);this.output=k.createGain();this.activateNode.connect(this.processor);this.processor.connect(this.output);var t=0,x=0,r,q,w,s,v;this.processor.onaudioprocess=function(y){r=y.inputBuffer.getChannelData(0),q=y.outputBuffer.getChannelData(0),w=Math.pow(1/2,this.bits);v=r.length;for(s=0;s<v;s++){t+=this.normfreq;if(t>=1){t-=1;x=w*Math.floor(r[s]/w+0.5)}q[s]=x}};this.bits=u.bits||this.defaults.bits.value;this.normfreq=m(u.normfreq,this.defaults.normfreq.value);this.bypass=u.bypass||false};b.prototype.Bitcrusher.prototype=Object.create(j,{name:{value:"Bitcrusher"},defaults:{writable:true,value:{bits:{value:4,min:1,max:16,automatable:false,type:c},bufferSize:{value:4096,min:256,max:16384,automatable:false,type:c},bypass:{value:false,automatable:false,type:h},normfreq:{value:0.1,min:0.0001,max:1,automatable:false,type:p}}},bits:{enumerable:true,get:function(){return this.processor.bits},set:function(q){this.processor.bits=q}},normfreq:{enumerable:true,get:function(){return this.processor.normfreq},set:function(q){this.processor.normfreq=q}}});b.prototype.Cabinet=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.convolver=this.newConvolver(q.impulsePath||"../impulses/impulse_guitar.wav");this.makeupNode=k.createGain();this.output=k.createGain();this.activateNode.connect(this.convolver.input);this.convolver.output.connect(this.makeupNode);this.makeupNode.connect(this.output);this.makeupGain=m(q.makeupGain,this.defaults.makeupGain);this.bypass=q.bypass||false};b.prototype.Cabinet.prototype=Object.create(j,{name:{value:"Cabinet"},defaults:{writable:true,value:{makeupGain:{value:1,min:0,max:20,automatable:true,type:p},bypass:{value:false,automatable:false,type:h}}},makeupGain:{enumerable:true,get:function(){return this.makeupNode.gain},set:function(q){this.makeupNode.gain.value=q}},newConvolver:{value:function(q){return new n.Convolver({impulse:q,dryLevel:0,wetLevel:1})}}});b.prototype.Chorus=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.attenuator=this.activateNode=k.createGain();this.splitter=k.createChannelSplitter(2);this.delayL=k.createDelay();this.delayR=k.createDelay();this.feedbackGainNodeLR=k.createGain();this.feedbackGainNodeRL=k.createGain();this.merger=k.createChannelMerger(2);this.output=k.createGain();this.lfoL=new n.LFO({target:this.delayL.delayTime,callback:g});this.lfoR=new n.LFO({target:this.delayR.delayTime,callback:g});this.input.connect(this.attenuator);this.attenuator.connect(this.output);this.attenuator.connect(this.splitter);this.splitter.connect(this.delayL,0);this.splitter.connect(this.delayR,1);this.delayL.connect(this.feedbackGainNodeLR);this.delayR.connect(this.feedbackGainNodeRL);this.feedbackGainNodeLR.connect(this.delayR);this.feedbackGainNodeRL.connect(this.delayL);this.delayL.connect(this.merger,0,0);this.delayR.connect(this.merger,0,1);this.merger.connect(this.output);this.feedback=m(q.feedback,this.defaults.feedback.value);this.rate=m(q.rate,this.defaults.rate.value);this.delay=m(q.delay,this.defaults.delay.value);this.depth=m(q.depth,this.defaults.depth.value);this.lfoR.phase=Math.PI/2;this.attenuator.gain.value=0.6934;this.lfoL.activate(true);this.lfoR.activate(true);this.bypass=q.bypass||false};b.prototype.Chorus.prototype=Object.create(j,{name:{value:"Chorus"},defaults:{writable:true,value:{feedback:{value:0.4,min:0,max:0.95,automatable:false,type:p},delay:{value:0.0045,min:0,max:1,automatable:false,type:p},depth:{value:0.7,min:0,max:1,automatable:false,type:p},rate:{value:1.5,min:0,max:8,automatable:false,type:p},bypass:{value:false,automatable:false,type:h}}},delay:{enumerable:true,get:function(){return this._delay},set:function(q){this._delay=0.0002*(Math.pow(10,q)*2);this.lfoL.offset=this._delay;this.lfoR.offset=this._delay;this._depth=this._depth}},depth:{enumerable:true,get:function(){return this._depth},set:function(q){this._depth=q;this.lfoL.oscillation=this._depth*this._delay;this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:true,get:function(){return this._feedback},set:function(q){this._feedback=q;this.feedbackGainNodeLR.gain.value=this._feedback;this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:true,get:function(){return this._rate},set:function(q){this._rate=q;this.lfoL.frequency=this._rate;this.lfoR.frequency=this._rate}}});b.prototype.Compressor=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.compNode=this.activateNode=k.createDynamicsCompressor();this.makeupNode=k.createGain();this.output=k.createGain();this.compNode.connect(this.makeupNode);this.makeupNode.connect(this.output);this.automakeup=m(q.automakeup,this.defaults.automakeup.value);this.makeupGain=m(q.makeupGain,this.defaults.makeupGain.value);this.threshold=m(q.threshold,this.defaults.threshold.value);this.release=m(q.release,this.defaults.release.value);this.attack=m(q.attack,this.defaults.attack.value);this.ratio=q.ratio||this.defaults.ratio.value;this.knee=m(q.knee,this.defaults.knee.value);this.bypass=q.bypass||false};b.prototype.Compressor.prototype=Object.create(j,{name:{value:"Compressor"},defaults:{writable:true,value:{threshold:{value:-20,min:-60,max:0,automatable:true,type:p},release:{value:250,min:10,max:2000,automatable:true,type:p},makeupGain:{value:1,min:1,max:100,automatable:true,type:p},attack:{value:1,min:0,max:1000,automatable:true,type:p},ratio:{value:4,min:1,max:50,automatable:true,type:p},knee:{value:5,min:0,max:40,automatable:true,type:p},automakeup:{value:false,automatable:false,type:h},bypass:{value:false,automatable:false,type:h}}},computeMakeup:{value:function(){var q=4,r=this.compNode;return -(r.threshold.value-r.threshold.value/r.ratio.value)/q}},automakeup:{enumerable:true,get:function(){return this._automakeup},set:function(q){this._automakeup=q;if(this._automakeup){this.makeupGain=this.computeMakeup()}}},threshold:{enumerable:true,get:function(){return this.compNode.threshold},set:function(q){this.compNode.threshold.value=q;if(this._automakeup){this.makeupGain=this.computeMakeup()}}},ratio:{enumerable:true,get:function(){return this.compNode.ratio},set:function(q){this.compNode.ratio.value=q;if(this._automakeup){this.makeupGain=this.computeMakeup()}}},knee:{enumerable:true,get:function(){return this.compNode.knee},set:function(q){this.compNode.knee.value=q;if(this._automakeup){this.makeupGain=this.computeMakeup()}}},attack:{enumerable:true,get:function(){return this.compNode.attack},set:function(q){this.compNode.attack.value=q/1000}},release:{enumerable:true,get:function(){return this.compNode.release},set:function(q){this.compNode.release.value=q/1000}},makeupGain:{enumerable:true,get:function(){return this.makeupNode.gain},set:function(q){this.makeupNode.gain.value=l(q)}}});b.prototype.Convolver=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.convolver=k.createConvolver();this.dry=k.createGain();this.filterLow=k.createBiquadFilter();this.filterHigh=k.createBiquadFilter();this.wet=k.createGain();this.output=k.createGain();this.activateNode.connect(this.filterLow);this.activateNode.connect(this.dry);this.filterLow.connect(this.filterHigh);this.filterHigh.connect(this.convolver);this.convolver.connect(this.wet);this.wet.connect(this.output);this.dry.connect(this.output);this.dryLevel=m(q.dryLevel,this.defaults.dryLevel.value);this.wetLevel=m(q.wetLevel,this.defaults.wetLevel.value);this.highCut=q.highCut||this.defaults.highCut.value;this.buffer=q.impulse||"../impulses/ir_rev_short.wav";this.lowCut=q.lowCut||this.defaults.lowCut.value;this.level=m(q.level,this.defaults.level.value);this.filterHigh.type="lowpass";this.filterLow.type="highpass";this.bypass=q.bypass||false};b.prototype.Convolver.prototype=Object.create(j,{name:{value:"Convolver"},defaults:{writable:true,value:{highCut:{value:22050,min:20,max:22050,automatable:true,type:p},lowCut:{value:20,min:20,max:22050,automatable:true,type:p},dryLevel:{value:1,min:0,max:1,automatable:true,type:p},wetLevel:{value:1,min:0,max:1,automatable:true,type:p},level:{value:1,min:0,max:1,automatable:true,type:p}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(q){this.filterLow.frequency.value=q}},highCut:{get:function(){return this.filterHigh.frequency},set:function(q){this.filterHigh.frequency.value=q}},level:{get:function(){return this.output.gain},set:function(q){this.output.gain.value=q}},dryLevel:{get:function(){return this.dry.gain},set:function(q){this.dry.gain.value=q}},wetLevel:{get:function(){return this.wet.gain},set:function(q){this.wet.gain.value=q}},buffer:{enumerable:false,get:function(){return this.convolver.buffer},set:function(q){var s=this.convolver,r=new XMLHttpRequest();if(!q){console.log("Tuna.Convolver.setBuffer: Missing impulse path!");return}r.open("GET",q,true);r.responseType="arraybuffer";r.onreadystatechange=function(){if(r.readyState===4){if(r.status<300&&r.status>199||r.status===302){k.decodeAudioData(r.response,function(t){s.buffer=t},function(t){if(t){console.log("Tuna.Convolver.setBuffer: Error decoding data"+t)}})}}};r.send(null)}}});b.prototype.Delay=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.dry=k.createGain();this.wet=k.createGain();this.filter=k.createBiquadFilter();this.delay=k.createDelay(10);this.feedbackNode=k.createGain();this.output=k.createGain();this.activateNode.connect(this.delay);this.activateNode.connect(this.dry);this.delay.connect(this.filter);this.filter.connect(this.feedbackNode);this.feedbackNode.connect(this.delay);this.feedbackNode.connect(this.wet);this.wet.connect(this.output);this.dry.connect(this.output);this.delayTime=q.delayTime||this.defaults.delayTime.value;this.feedback=m(q.feedback,this.defaults.feedback.value);this.wetLevel=m(q.wetLevel,this.defaults.wetLevel.value);this.dryLevel=m(q.dryLevel,this.defaults.dryLevel.value);this.cutoff=q.cutoff||this.defaults.cutoff.value;this.filter.type="lowpass";this.bypass=q.bypass||false};b.prototype.Delay.prototype=Object.create(j,{name:{value:"Delay"},defaults:{writable:true,value:{delayTime:{value:100,min:20,max:1000,automatable:false,type:p},feedback:{value:0.45,min:0,max:0.9,automatable:true,type:p},cutoff:{value:20000,min:20,max:20000,automatable:true,type:p},wetLevel:{value:0.5,min:0,max:1,automatable:true,type:p},dryLevel:{value:1,min:0,max:1,automatable:true,type:p}}},delayTime:{enumerable:true,get:function(){return this.delay.delayTime},set:function(q){this.delay.delayTime.value=q/1000}},wetLevel:{enumerable:true,get:function(){return this.wet.gain},set:function(q){this.wet.gain.value=q}},dryLevel:{enumerable:true,get:function(){return this.dry.gain},set:function(q){this.dry.gain.value=q}},feedback:{enumerable:true,get:function(){return this.feedbackNode.gain},set:function(q){this.feedbackNode.gain.value=q}},cutoff:{enumerable:true,get:function(){return this.filter.frequency},set:function(q){this.filter.frequency.value=q}}});b.prototype.Filter=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.filter=k.createBiquadFilter();this.output=k.createGain();this.activateNode.connect(this.filter);this.filter.connect(this.output);this.frequency=q.frequency||this.defaults.frequency.value;this.Q=q.resonance||this.defaults.Q.value;this.filterType=m(q.filterType,this.defaults.filterType.value);this.gain=m(q.gain,this.defaults.gain.value);this.bypass=q.bypass||false};b.prototype.Filter.prototype=Object.create(j,{name:{value:"Filter"},defaults:{writable:true,value:{frequency:{value:800,min:20,max:22050,automatable:true,type:p},Q:{value:1,min:0.001,max:100,automatable:true,type:p},gain:{value:0,min:-40,max:40,automatable:true,type:p},bypass:{value:false,automatable:false,type:h},filterType:{value:"lowpass",automatable:false,type:i}}},filterType:{enumerable:true,get:function(){return this.filter.type},set:function(q){this.filter.type=q}},Q:{enumerable:true,get:function(){return this.filter.Q},set:function(q){this.filter.Q.value=q}},gain:{enumerable:true,get:function(){return this.filter.gain},set:function(q){this.filter.gain.value=q}},frequency:{enumerable:true,get:function(){return this.filter.frequency},set:function(q){this.filter.frequency.value=q}}});b.prototype.Gain=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.gainNode=k.createGain();this.output=k.createGain();this.activateNode.connect(this.gainNode);this.gainNode.connect(this.output);this.gain=m(q.gain,this.defaults.gain.value);this.bypass=q.bypass||false};b.prototype.Gain.prototype=Object.create(j,{name:{value:"Gain"},defaults:{writable:true,value:{bypass:{value:false,automatable:false,type:h},gain:{value:1,automatable:true,type:p}}},gain:{enumerable:true,get:function(){return this.gainNode.gain},set:function(q){this.gainNode.gain.value=q}}});b.prototype.MoogFilter=function(z){if(!z){z=this.getDefaults()}this.bufferSize=z.bufferSize||this.defaults.bufferSize.value;this.input=k.createGain();this.activateNode=k.createGain();this.processor=k.createScriptProcessor(this.bufferSize,1,1);this.output=k.createGain();this.activateNode.connect(this.processor);this.processor.connect(this.output);var x,v,u,t,F,E,D,C;x=v=u=t=F=E=D=C=0;var A,r,y,s,w,q,B;this.processor.onaudioprocess=function(G){A=G.inputBuffer.getChannelData(0),r=G.outputBuffer.getChannelData(0),y=this.cutoff*1.16,B=0.35013*(y*y)*(y*y);s=this.resonance*(1-0.15*y*y);q=A.length;for(w=0;w<q;w++){A[w]-=C*s;A[w]*=B;F=A[w]+0.3*x+(1-y)*F;x=A[w];E=F+0.3*v+(1-y)*E;v=F;D=E+0.3*u+(1-y)*D;u=E;C=D+0.3*t+(1-y)*C;t=D;r[w]=C}};this.cutoff=m(z.cutoff,this.defaults.cutoff.value);this.resonance=m(z.resonance,this.defaults.resonance.value);this.bypass=z.bypass||false};b.prototype.MoogFilter.prototype=Object.create(j,{name:{value:"MoogFilter"},defaults:{writable:true,value:{bufferSize:{value:4096,min:256,max:16384,automatable:false,type:c},bypass:{value:false,automatable:false,type:h},cutoff:{value:0.065,min:0.0001,max:1,automatable:false,type:p},resonance:{value:3.5,min:0,max:4,automatable:false,type:p}}},cutoff:{enumerable:true,get:function(){return this.processor.cutoff},set:function(q){this.processor.cutoff=q}},resonance:{enumerable:true,get:function(){return this.processor.resonance},set:function(q){this.processor.resonance=q}}});b.prototype.Overdrive=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.inputDrive=k.createGain();this.waveshaper=k.createWaveShaper();this.outputDrive=k.createGain();this.output=k.createGain();this.activateNode.connect(this.inputDrive);this.inputDrive.connect(this.waveshaper);this.waveshaper.connect(this.outputDrive);this.outputDrive.connect(this.output);this.ws_table=new Float32Array(this.k_nSamples);this.drive=m(q.drive,this.defaults.drive.value);this.outputGain=m(q.outputGain,this.defaults.outputGain.value);this.curveAmount=m(q.curveAmount,this.defaults.curveAmount.value);this.algorithmIndex=m(q.algorithmIndex,this.defaults.algorithmIndex.value);this.bypass=q.bypass||false};b.prototype.Overdrive.prototype=Object.create(j,{name:{value:"Overdrive"},defaults:{writable:true,value:{drive:{value:1,min:0,max:1,automatable:true,type:p,scaled:true},outputGain:{value:1,min:0,max:1,automatable:true,type:p,scaled:true},curveAmount:{value:0.725,min:0,max:1,automatable:false,type:p},algorithmIndex:{value:0,min:0,max:5,automatable:false,type:c}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(q){this._drive=q}},curveAmount:{get:function(){return this._curveAmount},set:function(q){this._curveAmount=q;if(this._algorithmIndex===undefined){this._algorithmIndex=0}this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table);this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(q){this._outputGain=l(q)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(q){this._algorithmIndex=q;this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(u,s,v){u=Math.min(u,0.9999);var r=2*u/(1-u),t,q;for(t=0;t<s;t++){q=t*2/s-1;v[t]=(1+r)*q/(1+r*Math.abs(q))}},function(t,r,u){var s,q,v;for(s=0;s<r;s++){q=s*2/r-1;v=((0.5*Math.pow((q+1.4),2))-1)*v>=0?5.8:1.2;u[s]=a(v)}},function(u,s,v){var t,q,w,r=1-u;for(t=0;t<s;t++){q=t*2/s-1;w=q<0?-Math.pow(Math.abs(q),r+0.04):Math.pow(q,r);v[t]=a(w*2)}},function(u,s,w){var t,q,z,v,r=1-u>0.99?0.99:1-u;for(t=0;t<s;t++){q=t*2/s-1;v=Math.abs(q);if(v<r){z=v}else{if(v>r){z=r+(v-r)/(1+Math.pow((v-r)/(1-r),2))}else{if(v>1){z=v}}}w[t]=e(q)*z*(1/((r+1)/2))}},function(t,r,u){var s,q;for(s=0;s<r;s++){q=s*2/r-1;if(q<-0.08905){u[s]=(-3/4)*(1-(Math.pow((1-(Math.abs(q)-0.032857)),12))+(1/3)*(Math.abs(q)-0.032847))+0.01}else{if(q>=-0.08905&&q<0.320018){u[s]=(-6.153*(q*q))+3.9375*q}else{u[s]=0.630035}}}},function(u,s,v){var r=2+Math.round(u*14),w=Math.round(Math.pow(2,r-1)),t,q;for(t=0;t<s;t++){q=t*2/s-1;v[t]=Math.round(q*w)/w}}]}});b.prototype.Panner=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.panner=k.createStereoPanner();this.output=k.createGain();this.activateNode.connect(this.panner);this.panner.connect(this.output);this.pan=m(q.pan,this.defaults.pan.value);this.bypass=q.bypass||false};b.prototype.Panner.prototype=Object.create(j,{name:{value:"Panner"},defaults:{writable:true,value:{bypass:{value:false,automatable:false,type:h},pan:{value:0,min:-1,max:1,automatable:true,type:p}}},pan:{enumerable:true,get:function(){return this.panner.pan},set:function(q){this.panner.pan.value=q}}});b.prototype.Phaser=function(r){if(!r){r=this.getDefaults()}this.input=k.createGain();this.splitter=this.activateNode=k.createChannelSplitter(2);this.filtersL=[];this.filtersR=[];this.feedbackGainNodeL=k.createGain();this.feedbackGainNodeR=k.createGain();this.merger=k.createChannelMerger(2);this.filteredSignal=k.createGain();this.output=k.createGain();this.lfoL=new n.LFO({target:this.filtersL,callback:this.callback});this.lfoR=new n.LFO({target:this.filtersR,callback:this.callback});var q=this.stage;while(q--){this.filtersL[q]=k.createBiquadFilter();this.filtersR[q]=k.createBiquadFilter();this.filtersL[q].type="allpass";this.filtersR[q].type="allpass"}this.input.connect(this.splitter);this.input.connect(this.output);this.splitter.connect(this.filtersL[0],0,0);this.splitter.connect(this.filtersR[0],1,0);this.connectInOrder(this.filtersL);this.connectInOrder(this.filtersR);this.filtersL[this.stage-1].connect(this.feedbackGainNodeL);this.filtersL[this.stage-1].connect(this.merger,0,0);this.filtersR[this.stage-1].connect(this.feedbackGainNodeR);this.filtersR[this.stage-1].connect(this.merger,0,1);this.feedbackGainNodeL.connect(this.filtersL[0]);this.feedbackGainNodeR.connect(this.filtersR[0]);this.merger.connect(this.output);this.rate=m(r.rate,this.defaults.rate.value);this.baseModulationFrequency=r.baseModulationFrequency||this.defaults.baseModulationFrequency.value;this.depth=m(r.depth,this.defaults.depth.value);this.feedback=m(r.feedback,this.defaults.feedback.value);this.stereoPhase=m(r.stereoPhase,this.defaults.stereoPhase.value);this.lfoL.activate(true);this.lfoR.activate(true);this.bypass=r.bypass||false};b.prototype.Phaser.prototype=Object.create(j,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:true,value:{rate:{value:0.1,min:0,max:8,automatable:false,type:p},depth:{value:0.6,min:0,max:1,automatable:false,type:p},feedback:{value:0.7,min:0,max:1,automatable:false,type:p},stereoPhase:{value:40,min:0,max:180,automatable:false,type:p},baseModulationFrequency:{value:700,min:500,max:1500,automatable:false,type:p}}},callback:{value:function(r,s){for(var q=0;q<4;q++){r[q].frequency.value=s}}},depth:{get:function(){return this._depth},set:function(q){this._depth=q;this.lfoL.oscillation=this._baseModulationFrequency*this._depth;this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(q){this._rate=q;this.lfoL.frequency=this._rate;this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:true,get:function(){return this._baseModulationFrequency},set:function(q){this._baseModulationFrequency=q;this.lfoL.offset=this._baseModulationFrequency;this.lfoR.offset=this._baseModulationFrequency;this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(q){this._feedback=q;this.feedbackGainNodeL.gain.value=this._feedback;this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(r){this._stereoPhase=r;var q=this.lfoL._phase+this._stereoPhase*Math.PI/180;q=d(q,2*Math.PI);this.lfoR._phase=q}}});b.prototype.PingPongDelay=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.wetLevel=k.createGain();this.stereoToMonoMix=k.createGain();this.feedbackLevel=k.createGain();this.output=k.createGain();this.delayLeft=k.createDelay(10);this.delayRight=k.createDelay(10);this.activateNode=k.createGain();this.splitter=k.createChannelSplitter(2);this.merger=k.createChannelMerger(2);this.activateNode.connect(this.splitter);this.splitter.connect(this.stereoToMonoMix,0,0);this.splitter.connect(this.stereoToMonoMix,1,0);this.stereoToMonoMix.gain.value=0.5;this.stereoToMonoMix.connect(this.wetLevel);this.wetLevel.connect(this.delayLeft);this.feedbackLevel.connect(this.delayLeft);this.delayLeft.connect(this.delayRight);this.delayRight.connect(this.feedbackLevel);this.delayLeft.connect(this.merger,0,0);this.delayRight.connect(this.merger,0,1);this.merger.connect(this.output);this.activateNode.connect(this.output);this.delayTimeLeft=q.delayTimeLeft!==undefined?q.delayTimeLeft:this.defaults.delayTimeLeft.value;this.delayTimeRight=q.delayTimeRight!==undefined?q.delayTimeRight:this.defaults.delayTimeRight.value;this.feedbackLevel.gain.value=q.feedback!==undefined?q.feedback:this.defaults.feedback.value;this.wetLevel.gain.value=q.wetLevel!==undefined?q.wetLevel:this.defaults.wetLevel.value;this.bypass=q.bypass||false};b.prototype.PingPongDelay.prototype=Object.create(j,{name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:true,get:function(){return this._delayTimeLeft},set:function(q){this._delayTimeLeft=q;this.delayLeft.delayTime.value=q/1000}},delayTimeRight:{enumerable:true,get:function(){return this._delayTimeRight},set:function(q){this._delayTimeRight=q;this.delayRight.delayTime.value=q/1000}},defaults:{writable:true,value:{delayTimeLeft:{value:200,min:1,max:10000,automatable:false,type:c},delayTimeRight:{value:400,min:1,max:10000,automatable:false,type:c},feedback:{value:0.3,min:0,max:1,automatable:false,type:p},wetLevel:{value:0.5,min:0,max:1,automatable:false,type:p}}}});b.prototype.Tremolo=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.splitter=this.activateNode=k.createChannelSplitter(2),this.amplitudeL=k.createGain(),this.amplitudeR=k.createGain(),this.merger=k.createChannelMerger(2),this.output=k.createGain();this.lfoL=new n.LFO({target:this.amplitudeL.gain,callback:g});this.lfoR=new n.LFO({target:this.amplitudeR.gain,callback:g});this.input.connect(this.splitter);this.splitter.connect(this.amplitudeL,0);this.splitter.connect(this.amplitudeR,1);this.amplitudeL.connect(this.merger,0,0);this.amplitudeR.connect(this.merger,0,1);this.merger.connect(this.output);this.rate=q.rate||this.defaults.rate.value;this.intensity=m(q.intensity,this.defaults.intensity.value);this.stereoPhase=m(q.stereoPhase,this.defaults.stereoPhase.value);this.lfoL.offset=1-(this.intensity/2);this.lfoR.offset=1-(this.intensity/2);this.lfoL.phase=this.stereoPhase*Math.PI/180;this.lfoL.activate(true);this.lfoR.activate(true);this.bypass=q.bypass||false};b.prototype.Tremolo.prototype=Object.create(j,{name:{value:"Tremolo"},defaults:{writable:true,value:{intensity:{value:0.3,min:0,max:1,automatable:false,type:p},stereoPhase:{value:0,min:0,max:180,automatable:false,type:p},rate:{value:5,min:0.1,max:11,automatable:false,type:p}}},intensity:{enumerable:true,get:function(){return this._intensity},set:function(q){this._intensity=q;this.lfoL.offset=1-this._intensity/2;this.lfoR.offset=1-this._intensity/2;this.lfoL.oscillation=this._intensity;this.lfoR.oscillation=this._intensity}},rate:{enumerable:true,get:function(){return this._rate},set:function(q){this._rate=q;this.lfoL.frequency=this._rate;this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:true,get:function(){return this._stereoPhase},set:function(r){this._stereoPhase=r;var q=this.lfoL._phase+this._stereoPhase*Math.PI/180;q=d(q,2*Math.PI);this.lfoR.phase=q}}});b.prototype.WahWah=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.activateNode=k.createGain();this.envelopeFollower=new n.EnvelopeFollower({target:this,callback:function(r,s){r.sweep=s}});this.filterBp=k.createBiquadFilter();this.filterPeaking=k.createBiquadFilter();this.output=k.createGain();this.activateNode.connect(this.filterBp);this.filterBp.connect(this.filterPeaking);this.filterPeaking.connect(this.output);this.init();this.automode=m(q.automode,this.defaults.automode.value);this.resonance=q.resonance||this.defaults.resonance.value;this.sensitivity=m(q.sensitivity,this.defaults.sensitivity.value);this.baseFrequency=m(q.baseFrequency,this.defaults.baseFrequency.value);this.excursionOctaves=q.excursionOctaves||this.defaults.excursionOctaves.value;this.sweep=m(q.sweep,this.defaults.sweep.value);this.activateNode.gain.value=2;this.envelopeFollower.activate(true);this.bypass=q.bypass||false};b.prototype.WahWah.prototype=Object.create(j,{name:{value:"WahWah"},defaults:{writable:true,value:{automode:{value:true,automatable:false,type:h},baseFrequency:{value:0.5,min:0,max:1,automatable:false,type:p},excursionOctaves:{value:2,min:1,max:6,automatable:false,type:p},sweep:{value:0.2,min:0,max:1,automatable:false,type:p},resonance:{value:10,min:1,max:100,automatable:false,type:p},sensitivity:{value:0.5,min:-1,max:1,automatable:false,type:p}}},automode:{get:function(){return this._automode},set:function(q){this._automode=q;if(q){this.activateNode.connect(this.envelopeFollower.input);this.envelopeFollower.activate(true)}else{this.envelopeFollower.activate(false);this.activateNode.disconnect();this.activateNode.connect(this.filterBp)}}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=Math.min(22050,this._baseFrequency+this._excursionFrequency*this._sweep);this.filterPeaking.frequency.value=Math.min(22050,this._baseFrequency+this._excursionFrequency*this._sweep)}catch(q){clearTimeout(this.filterFreqTimeout);this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:true,get:function(){return this._sweep},set:function(q){this._sweep=Math.pow(q>1?1:q<0?0:q,this._sensitivity);this.setFilterFreq()}},baseFrequency:{enumerable:true,get:function(){return this._baseFrequency},set:function(q){this._baseFrequency=50*Math.pow(10,q*2);this._excursionFrequency=Math.min(k.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves));this.setFilterFreq()}},excursionOctaves:{enumerable:true,get:function(){return this._excursionOctaves},set:function(q){this._excursionOctaves=q;this._excursionFrequency=Math.min(k.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves));this.setFilterFreq()}},sensitivity:{enumerable:true,get:function(){return this._sensitivity},set:function(q){this._sensitivity=Math.pow(10,q)}},resonance:{enumerable:true,get:function(){return this._resonance},set:function(q){this._resonance=q;this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1;this.filterPeaking.type="peaking";this.filterBp.type="bandpass";this.filterPeaking.frequency.value=100;this.filterPeaking.gain.value=20;this.filterPeaking.Q.value=5;this.filterBp.frequency.value=100;this.filterBp.Q.value=1}}});b.prototype.EnvelopeFollower=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.jsNode=this.output=k.createScriptProcessor(this.buffersize,1,1);this.input.connect(this.output);this.attackTime=m(q.attackTime,this.defaults.attackTime.value);this.releaseTime=m(q.releaseTime,this.defaults.releaseTime.value);this._envelope=0;this.target=q.target||{};this.callback=q.callback||function(){};this.bypass=q.bypass||false};b.prototype.EnvelopeFollower.prototype=Object.create(j,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:0.003,min:0,max:0.5,automatable:false,type:p},releaseTime:{value:0.5,min:0,max:0.5,automatable:false,type:p}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:true,get:function(){return this._attackTime},set:function(q){this._attackTime=q;this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:true,get:function(){return this._releaseTime},set:function(q){this._releaseTime=q;this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(q){if(typeof q==="function"){this._callback=q}else{console.error("tuna.js: "+this.name+": Callback must be a function!")}}},target:{get:function(){return this._target},set:function(q){this._target=q}},activate:{value:function(q){this.activated=q;if(q){this.jsNode.connect(k.destination);this.jsNode.onaudioprocess=this.returnCompute(this)}else{this.jsNode.disconnect();this.jsNode.onaudioprocess=null}if(this.activateCallback){this.activateCallback(q)}}},returnCompute:{value:function(q){return function(r){q.compute(r)}}},compute:{value:function(t){var s=t.inputBuffer.getChannelData(0).length,q=t.inputBuffer.numberOfChannels,v,u,w,r;u=w=r=0;if(q>1){for(r=0;r<s;++r){for(;u<q;++u){v=t.inputBuffer.getChannelData(u)[r];w+=(v*v)/q}}}else{for(r=0;r<s;++r){v=t.inputBuffer.getChannelData(0)[r];w+=(v*v)}}w=Math.sqrt(w);if(this._envelope<w){this._envelope*=this._attackC;this._envelope+=(1-this._attackC)*w}else{this._envelope*=this._releaseC;this._envelope+=(1-this._releaseC)*w}this._callback(this._target,this._envelope)}}});b.prototype.LFO=function(q){if(!q){q=this.getDefaults()}this.input=k.createGain();this.output=k.createScriptProcessor(256,1,1);this.activateNode=k.destination;this.frequency=m(q.frequency,this.defaults.frequency.value);this.offset=m(q.offset,this.defaults.offset.value);this.oscillation=m(q.oscillation,this.defaults.oscillation.value);this.phase=m(q.phase,this.defaults.phase.value);this.target=q.target||{};this.output.onaudioprocess=this.callback(q.callback||function(){});this.bypass=q.bypass||false};b.prototype.LFO.prototype=Object.create(j,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:false,type:p},offset:{value:0.85,min:0,max:22049,automatable:false,type:p},oscillation:{value:0.3,min:-22050,max:22050,automatable:false,type:p},phase:{value:0,min:0,max:2*Math.PI,automatable:false,type:p}}},frequency:{get:function(){return this._frequency},set:function(q){this._frequency=q;this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(q){this._offset=q}},oscillation:{get:function(){return this._oscillation},set:function(q){this._oscillation=q}},phase:{get:function(){return this._phase},set:function(q){this._phase=q}},target:{get:function(){return this._target},set:function(q){this._target=q}},activate:{value:function(q){if(q){this.output.connect(k.destination);if(this.activateCallback){this.activateCallback(q)}}else{this.output.disconnect()}}},callback:{value:function(r){var q=this;return function(){q._phase+=q._phaseInc;if(q._phase>2*Math.PI){q._phase=0}r(q._target,q._offset+q._oscillation*Math.sin(q._phase))}}}});b.toString=b.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}})();